import{b as O}from"../chunks/fetchStaticData.CD1NSirk.js";import{P as F,F as $}from"../chunks/common.3e1mQu3z.js";import{a as L,e as m,b as V,c as g,d as _,x as U,h as W,f as p,j as y,l as N,m as u,u as X,z as Y,o as z,H as K,I as q,T as G}from"../chunks/scheduler.DOxgmCTI.js";import{S as J,i as Q,b as Z,d as tt,m as et,a as nt,t as at,e as rt}from"../chunks/index.BPs-IL2Q.js";import{I as ot}from"../chunks/Icon.CASDk692.js";import{g as j}from"../chunks/numerics.BpAOxbdF.js";async function st({fetch:r}){await O(r,"load to cache");const t=await s();async function s(){const i=Array.from({length:F},(c,n)=>$+n).map(async c=>(await O(r,c.toString())).imageUrl??null);return(await Promise.all(i)).filter(c=>c!==null)}return{imageUrls:t}}const Rt=Object.freeze(Object.defineProperty({__proto__:null,load:st},Symbol.toStringTag,{value:"Module"}));function it(){return Matter.Engine.create({enableSleeping:!0,positionIterations:6,velocityIterations:4,constraintIterations:6})}function ct(){return Matter.Runner.create()}function lt(r,t){return Matter.Render.create({element:t,engine:r,options:{width:t.clientWidth,height:t.clientHeight,pixelRatio:1,background:"transparent",hasBounds:!1,wireframes:!1,showSleeping:!1}})}function dt(r,t){const s=Matter.Mouse.create(t.canvas);return t.mouse=s,Matter.MouseConstraint.create(r,{mouse:s,constraint:{stiffness:.2,damping:0,length:0,render:{visible:!1,lineWidth:2,strokeStyle:"#00ff00"}}})}async function ut(r){const t=r.clientWidth,s=r.clientHeight;function e(a,c,n,o){return[{x:a/2-o,y:-n/2,w:a+o*2,h:n},{x:a/2-o,y:c+n/2,w:a+o*2,h:n},{x:-n/2,y:c/2-o,w:n,h:c+o*2},{x:a+n/2,y:c/2-o,w:n,h:c+o*2}]}const i=e(t,s,2e3,0).map(a=>Matter.Bodies.rectangle(a.x,a.y,a.w,a.h,{isStatic:!0,render:{visible:!1}}));return Matter.Composite.add(Matter.Composite.create(),i)}function ft(r,t,s,e){function i(){e.isHolding=!0,Matter.World.add(r,t)}function a(){e.isHolding=!1,Matter.World.remove(r,t)}function c(){e.isHolding=!1,t.constraint.bodyA=null,t.constraint.bodyB=null,t.mouse.position={x:-1,y:-1},Matter.World.remove(r,t)}function n(o){const d=s.getBoundingClientRect();(o.clientX<d.left||o.clientX>d.right||o.clientY<d.top||o.clientY>d.bottom)&&Matter.World.remove(r,t)}return{pointerdown:i,pointerup:a,pointerleave:c,pointermove:n}}async function mt(r,t){const s=await gt(r),e=yt(s),i=pt(e,s.width,s.height),a=ht(i);return vt(a,t)}async function gt(r){return new Promise((t,s)=>{const e=new Image;e.crossOrigin="Anonymous",e.src=r,e.onload=()=>t(e),e.onerror=i=>s(i)})}function yt(r){const{width:t,height:s}=r,e=document.createElement("canvas");e.width=t,e.height=s;const i=e.getContext("2d");if(!i)throw new Error("Canvas context could not be obtained");return i.drawImage(r,0,0,t,s),i.getImageData(0,0,t,s).data}function pt(r,t,s){const e=[],i=new Set;function a(n,o){const d=(o*t+n)*4;return r[d+3]===0}function c(n,o){const d=`${n},${o}`;i.has(d)||(e.push({x:n,y:o}),i.add(d))}for(let n=0;n<s;n++)for(let o=0;o<t;o++)a(o,n)||((n===0||a(o,n-1))&&c(o,n),(n===s-1||a(o,n+1))&&c(o,n),(o===0||a(o-1,n))&&c(o,n),(o===t-1||a(o+1,n))&&c(o,n));return e}function ht(r){const t=r.reduce((e,i)=>(e.x+=i.x,e.y+=i.y,e),{x:0,y:0});t.x/=r.length,t.y/=r.length;const s=r.map(e=>{const i=Math.atan2(e.y-t.y,e.x-t.x);return{...e,angle:i}});return s.sort((e,i)=>e.angle-i.angle),s.map(e=>({x:e.x,y:e.y}))}function vt(r,t){const s=r.reduce((i,a)=>i+a.x,0)/r.length,e=r.reduce((i,a)=>i+a.y,0)/r.length;return r.map(i=>({x:s+(i.x-s)*t,y:e+(i.y-e)*t}))}async function _t(r,t,s){const e=await mt(r,t*.9);return Matter.Bodies.fromVertices(s.x,s.y,[e],{restitution:.2,friction:.1,density:.001,render:{sprite:{texture:r,xScale:t,yScale:t}}})}function wt(r){let t,s,e='<h1 class="cTitleStyle">ポケモンとりほうだい</h1>',i,a,c,n,o,d="ポケモン ゲットだぜ！",I,w,l,f,h,S,M,b,P,R,k;return h=new ot({props:{icon:"mdi:pokeball",class:"cIconStyle"}}),{c(){t=m("div"),s=m("div"),s.innerHTML=e,i=V(),a=m("div"),c=m("div"),n=m("div"),o=m("span"),o.textContent=d,I=V(),w=m("form"),l=m("button"),f=m("div"),Z(h.$$.fragment),S=V(),M=m("div"),b=m("div"),this.h()},l(v){t=g(v,"DIV",{class:!0});var x=_(t);s=g(x,"DIV",{class:!0,"data-svelte-h":!0}),U(s)!=="svelte-jgc82w"&&(s.innerHTML=e),i=W(x),a=g(x,"DIV",{class:!0});var E=_(a);c=g(E,"DIV",{class:!0});var C=_(c);n=g(C,"DIV",{class:!0});var D=_(n);o=g(D,"SPAN",{class:!0,"data-svelte-h":!0}),U(o)!=="svelte-2lras7"&&(o.textContent=d),I=W(D),w=g(D,"FORM",{});var H=_(w);l=g(H,"BUTTON",{type:!0,class:!0});var T=_(l);f=g(T,"DIV",{class:!0});var B=_(f);tt(h.$$.fragment,B),B.forEach(p),T.forEach(p),H.forEach(p),D.forEach(p),C.forEach(p),S=W(E),M=g(E,"DIV",{class:!0});var A=_(M);b=g(A,"DIV",{class:!0}),_(b).forEach(p),A.forEach(p),E.forEach(p),x.forEach(p),this.h()},h(){y(s,"class","cTitlePartStyle"),y(o,"class","text-lg"),y(f,"class","cIconDivStyle"),y(l,"type","submit"),y(l,"class","cIconButtonStyle"),y(n,"class","cInputFormAndMessagePartStyle"),y(c,"class","flex items-center justify-center"),y(b,"class","w-80 h-80 bg-gray-300 border border-black"),y(M,"class","m-4"),y(a,"class","cContentPartStyle"),y(t,"class","cRouteBodyStyle")},m(v,x){N(v,t,x),u(t,s),u(t,i),u(t,a),u(a,c),u(c,n),u(n,o),u(n,I),u(n,w),u(w,l),u(l,f),et(h,f,null),u(a,S),u(a,M),u(M,b),r[3](b),P=!0,R||(k=X(w,"submit",Y(r[1])),R=!0)},p:z,i(v){P||(nt(h.$$.fragment,v),P=!0)},o(v){at(h.$$.fragment,v),P=!1},d(v){v&&p(t),rt(h),r[3](null),R=!1,k()}}}let Mt=!1;function bt(r,t,s){let{data:e}=t,i,a,c,n,o;K(async()=>{a=it(),c=ct(),n=lt(a,i),o=dt(a,n);const l=await ut(i);{Matter.World.add(a.world,l),Matter.Runner.run(c,a),Matter.Render.run(n);let f=ft(a.world,o,i,{isHolding:Mt});if(!f)return;Object.entries(f).forEach(([h,S])=>{i.addEventListener(h,S)})}}),q(()=>{{Matter.Render.stop(n),Matter.Runner.stop(c),Matter.World.clear(a.world,!1),Matter.Engine.clear(a);return}});let d;async function I(){d=j(e.imageUrls.length);const l=j(100),f=await _t(e.imageUrls[d],1,{x:50+l*2,y:20});Matter.World.add(a.world,[f])}function w(l){G[l?"unshift":"push"](()=>{i=l,s(0,i)})}return r.$$set=l=>{"data"in l&&s(2,e=l.data)},[i,I,e,w]}class Vt extends J{constructor(t){super(),Q(this,t,bt,wt,L,{data:2})}}export{Vt as component,Rt as universal};
