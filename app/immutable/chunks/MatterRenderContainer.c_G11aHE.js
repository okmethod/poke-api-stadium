import{a as e,e as t,c as n,d as r,f as o,j as i,l as a,o as s,J as c,M as u,C as l}from"./scheduler.DlxO6Kfx.js";import{S as d,i as h}from"./index.DMIAoLi9.js";async function m(e){const t=await async function(e){return new Promise(((t,n)=>{const r=new Image;r.crossOrigin="Anonymous",r.src=e,r.onload=()=>t(r),r.onerror=e=>n(e)}))}(e),n=function(e){const{width:t,height:n}=e,r=document.createElement("canvas");r.width=t,r.height=n;const o=r.getContext("2d");if(!o)throw new Error("Canvas context could not be obtained");o.drawImage(e,0,0,t,n);return o.getImageData(0,0,t,n).data}(t),r=function(e,t,n){const r=[],o=new Set;function i(n,r){return 0===e[4*(r*t+n)+3]}function a(e,t){const n=`${e},${t}`;o.has(n)||(r.push({x:e,y:t}),o.add(n))}for(let s=0;s<n;s++)for(let e=0;e<t;e++)i(e,s)||((0===s||i(e,s-1))&&a(e,s),(s===n-1||i(e,s+1))&&a(e,s),(0===e||i(e-1,s))&&a(e,s),(e===t-1||i(e+1,s))&&a(e,s));return r}(n,t.width,t.height),o=function(e){const t=e.reduce(((e,t)=>(e.x+=t.x,e.y+=t.y,e)),{x:0,y:0});t.x/=e.length,t.y/=e.length;const n=e.map((e=>{const n=Math.atan2(e.y-t.y,e.x-t.x);return{...e,angle:n}}));return n.sort(((e,t)=>e.angle-t.angle)),n.map((e=>({x:e.x,y:e.y})))}(r);return o}async function f(e,t,n,r){const o=await m(e);let i=1,a=o;if(t){const e=Matter.Bounds.create(o),n=e.max.x-e.min.x,r=e.max.y-e.min.y;i=t/Math.max(n,r)}a=function(e,t){const n=e.reduce(((e,t)=>e+t.x),0)/e.length,r=e.reduce(((e,t)=>e+t.y),0)/e.length;return e.map((e=>({x:n+(e.x-n)*t,y:r+(e.y-r)*t})))}(o,i*n*.8);const s=function(e){const t=e.slice();for(let r=0;r<t.length;r++)n(t[r],t[(r+1)%t.length],t[(r+2)%t.length])||(t.splice((r+1)%t.length,1),r=-1);function n(e,t,n){return(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)>=0}return t}(a);return Matter.Bodies.fromVertices(r.x,r.y,[s],{restitution:.2,friction:.1,render:{sprite:{texture:e,xScale:i*n,yScale:i*n}}})}function g(e){const t=Matter.Engine.create({enableSleeping:!0,positionIterations:6,velocityIterations:4,constraintIterations:6}),n=Matter.Runner.create(),r=function(e,t){const n=Matter.Render.create({element:t,engine:e,options:{width:t.clientWidth,height:t.clientHeight,pixelRatio:1,background:"transparent",hasBounds:!1,wireframes:!1,showSleeping:!1}});return n}(t,e),o=function(e,t){const n=Matter.Mouse.create(t.canvas);t.mouse=n;const r=Matter.MouseConstraint.create(e,{mouse:n,constraint:{stiffness:.2,damping:0,length:0,render:{visible:!1,lineWidth:2,strokeStyle:"#00ff00"}}});return r}(t,r),i=function(e){const t=e.clientWidth,n=e.clientHeight;function r(e,t,n,r){return[{x:e/2-r,y:-n/2,w:e+2*r,h:n},{x:e/2-r,y:t+n/2,w:e+2*r,h:n},{x:-n/2,y:t/2-r,w:n,h:t+2*r},{x:e+n/2,y:t/2-r,w:n,h:t+2*r}]}const o=r(t,n,2e3,0).map((e=>Matter.Bodies.rectangle(e.x,e.y,e.w,e.h,{isStatic:!0,render:{visible:!1}})));return Matter.Composite.add(Matter.Composite.create(),o)}(e);return{engine:t,runner:n,render:r,mouseConstraint:o,walls:i}}function p(e,t,n,r){const o=function(e,t,n,r){return{pointerdown:function(){r.isHolding=!0,Matter.Composite.add(e,t)},pointerup:function(){r.isHolding=!1,Matter.Composite.remove(e,t)},pointerleave:function(){r.isHolding=!1,t.constraint.bodyA=null,t.constraint.bodyB=null,t.mouse.position={x:-1,y:-1},Matter.Composite.remove(e,t)},pointermove:function(r){const o=n.getBoundingClientRect();(r.clientX<o.left||r.clientX>o.right||r.clientY<o.top||r.clientY>o.bottom)&&Matter.Composite.remove(e,t)}}}(e,t,n,r);return Object.entries(o).forEach((([e,t])=>{n.addEventListener(e,t)})),()=>{Object.entries(o).forEach((([e,t])=>{n.removeEventListener(e,t)}))}}function x(e){let c;return{c(){c=t("div"),this.h()},l(e){c=n(e,"DIV",{class:!0}),r(c).forEach(o),this.h()},h(){i(c,"class","w-80 h-80 bg-gray-300 border border-black")},m(t,n){a(t,c,n),e[2](c)},p:s,i:s,o:s,d(t){t&&o(c),e[2](null)}}}function y(e,t,n){let{renderContainer:r}=t,{matterBase:o}=t;{let e;c((async()=>{n(1,o=g(r)),function(e){Matter.Composite.add(e.engine.world,e.walls),Matter.Runner.run(e.runner,e.engine),Matter.Render.run(e.render)}(o),e=p(o.engine.world,o.mouseConstraint,r,{isHolding:false})})),u((()=>{!function(e){Matter.Render.stop(e.render),Matter.Runner.stop(e.runner),Matter.Composite.clear(e.engine.world,!1),Matter.Engine.clear(e.engine)}(o),e&&e()}))}return e.$$set=e=>{"renderContainer"in e&&n(0,r=e.renderContainer),"matterBase"in e&&n(1,o=e.matterBase)},[r,o,function(e){l[e?"unshift":"push"]((()=>{r=e,n(0,r)}))}]}class M extends d{constructor(t){super(),h(this,t,y,x,e,{renderContainer:0,matterBase:1})}}export{M,f as c};
